{
  "name": "projects/1017425675889/locations/europe-west3/instances/a099fd02-80fc-4a0f-a80c-fb5d7fe78564/rules/ru_2403e725-a123-4af2-a83f-f56c7f3a5452",
  "revisionId": "v_1716806233_444095000",
  "displayName": "sw_suspicious_download_office",
  "text": "rule sw_suspicious_download_office {\n    //THIS IS FOR SECOPS WORKSHOP, PLEASE DO NOT EDIT OR RUN RETROHUNTS ON THIS RULE\n  meta:\n    author = \"Google Cloud Security\"\n    description = \"Office Application downloading an executable(.exe in URL) or a suspiciously large file(>100KB)\"\n    mitre_attack_tactic = \"Execution\"\n    mitre_attack_technique = \"User Execution: Malicious Link\"\n    mitre_attach_url = \"https://attack.mitre.org/techniques/T1204/001/\"\n    mitre_attack_version = \"v13.1\"\n    severity = \"Critical\"\n    priority = \"Critical\"\n\n  events:\n    $edr_event.metadata.product_event_type = \"PROCESS_LAUNCH\"\n    $edr_event.metadata.product_name = \"Stream\"\n    $edr_event.metadata.vendor_name = \"Tanium\"\n    $edr_event.target.process.file.full_path = /\\\\excel\\.exe/ nocase\n    $edr_event.principal.user.userid = $user\n\n    $proxy_event.metadata.event_type = \"NETWORK_HTTP\"\n    $proxy_event.metadata.product_name = \"NSS\"\n    $proxy_event.metadata.vendor_name = \"Zscaler\"\n    $proxy_event.network.application_protocol = \"HTTP\"\n    $proxy_event.target.url = /.*\\.js$/\n    $proxy_event.principal.user.userid = $user\n\n    $proxy_event.metadata.event_timestamp.seconds >= $edr_event.metadata.event_timestamp.seconds\n\n  match:\n    $user over 5m\n\n  outcome:\n    $risk_score = max(90)\n    $mitre_attack_tactic = \"Execution\"\n    $mitre_attack_technique = \"User Execution: Malicious Link\"\n    $mitre_attack_technique_id = \"T1204.001\"\n    $edr_target_process_file_md5 = array_distinct($edr_event.target.process.file.md5)\n    $edr_principal_user_email_addresses = array_distinct($edr_event.principal.user.email_addresses)\n    $edr_principal_user_userid = array_distinct($edr_event.principal.user.userid)\n    $proxy_principal_hostname = array_distinct($proxy_event.principal.hostname)\n    $proxy_principal_ip = array_distinct($proxy_event.principal.ip)\n    $proxy_principal_mac = array_distinct($proxy_event.principal.mac)\n    $proxy_target_hostname = array_distinct($proxy_event.target.hostname)\n    $proxy_target_ip = array_distinct($proxy_event.target.ip)\n    $proxy_target_url = array_distinct($proxy_event.target.url)\n\n  condition:\n    $edr_event and $proxy_event\n}\n",
  "author": "Google Cloud Security",
  "severity": {
    "displayName": "Critical"
  },
  "metadata": {
    "mitre_attack_tactic": "Execution",
    "mitre_attack_technique": "User Execution: Malicious Link",
    "mitre_attach_url": "https://attack.mitre.org/techniques/T1204/001/",
    "mitre_attack_version": "v13.1",
    "priority": "Critical",
    "description": "Office Application downloading an executable(.exe in URL) or a suspiciously large file(>100KB)"
  },
  "createTime": "2024-05-27T10:37:13.444095Z",
  "revisionCreateTime": "2024-05-27T10:37:13.444095Z",
  "compilationState": "SUCCEEDED",
  "type": "MULTI_EVENT",
  "allowedRunFrequencies": [
    "LIVE",
    "HOURLY",
    "DAILY"
  ],
  "etag": "CNnE0bIGEJi04dMB",
  "inputsUsed": {
    "usesUdm": true
  }
}