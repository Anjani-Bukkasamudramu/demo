{
  "name": "projects/1017425675889/locations/europe-west3/instances/a099fd02-80fc-4a0f-a80c-fb5d7fe78564/rules/ru_fef7389b-45c8-4dda-baf0-3d72cef45505",
  "revisionId": "v_1734056921_664607000",
  "displayName": "TCS_Custom_ueba_first_time_interactive_service_account_login_by_user_id",
  "text": "\nrule TCS_Custom_ueba_first_time_interactive_service_account_login_by_user_id {\n\nmeta:\n    rule_name = \"First Time Interactive Service Account Login by Principal User ID and Target Service Account\" \n    description = \"Detects the first time a user has a successful interactive service account login, tracked by principal user ID and target service account in the last 30 days. This may be indicative of behavior related to entry vectors.\" \n    severity = \"Low\"\n    tactic = \"TA0001\" // Initial Access\n    technique = \"T1113\" // External Remote Services\n\nevents:\n    $e.metadata.event_type = \"USER_LOGIN\"\n    ($e.security_result.action = \"ALLOW\" or $e.security_result.action = \"ALLOW_WITH_MODIFICATION\") \n    $service_account = $e.target.user.userid\n    $user_id = $e.principal.user.userid\n\n    $e.target.user.attribute.labels.value = /OU=Service Accounts/ nocase \n    $e.extensions.auth.auth_details = /Logon Type (2|10)/ nocase\n\nmatch:\n    $user_id, $service_account over 48h\n\noutcome:\n    $risk_score = max(35)\n    $event_count = count_distinct ($e.metadata.id)\n    \n    $historical_threshold = max(metrics.auth_attempts_success(\n        period: 1d, window: 30d,\n        metric: first_seen, agg:min,\n        principal.user.userid: $user_id, target.user.userid:$service_account))\n    \n    $principal_user_id = array_distinct ($user_id)\n    $target_service_account = array_distinct ($service_account)\n\ncondition:\n        $e and ($historical_threshold = 0)\n}\n",
  "severity": {
    "displayName": "Low"
  },
  "metadata": {
    "rule_name": "First Time Interactive Service Account Login by Principal User ID and Target Service Account",
    "description": "Detects the first time a user has a successful interactive service account login, tracked by principal user ID and target service account in the last 30 days. This may be indicative of behavior related to entry vectors.",
    "tactic": "TA0001",
    "technique": "T1113"
  },
  "createTime": "2024-12-13T02:28:41.664607Z",
  "revisionCreateTime": "2024-12-13T02:28:41.664607Z",
  "compilationState": "SUCCEEDED",
  "type": "MULTI_EVENT",
  "allowedRunFrequencies": [
    "HOURLY",
    "DAILY"
  ],
  "etag": "CNm37roGEJiy9LwC",
  "inputsUsed": {
    "usesUdm": true
  }
}